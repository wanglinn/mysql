
目的：分析获取where 条件中对应的字段名及字段值

# 1. 语句 select sql_no_cache * from t1 where id1=1;

(gdb) p thd->lex->select_lex->m_where_cond->type()
$3 = Item::FUNC_ITEM
(gdb) p thd->lex->select_lex->m_where_cond
$4 = (Item_func_eq *) 0x7f1240006ed8


p *(Item_func_eq *)(thd->lex->select_lex->m_where_cond)

(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->functype()
$11 = Item_func::EQ_FUNC

(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->argument_count()
$18 = 2

#0  mysql_execute_command (thd=0x7f1240000b90, first_level=true) at /home/wl/software/mysql5726/sql/sql_parse.cc:2445
#1  0x00000000015426e8 in mysql_parse (thd=0x7f1240000b90, parser_state=0x7f125b565690) at /home/wl/software/mysql5726/sql/sql_parse.cc:5577
#2  0x0000000001537fb5 in dispatch_command (thd=0x7f1240000b90, com_data=0x7f125b565df0, command=COM_QUERY) at /home/wl/software/mysql5726/sql/sql_parse.cc:1484
#3  0x0000000001536e1e in do_command (thd=0x7f1240000b90) at /home/wl/software/mysql5726/sql/sql_parse.cc:1025
#4  0x0000000001667862 in handle_connection (arg=0x4aa8720) at /home/wl/software/mysql5726/sql/conn_handler/connection_handler_per_thread.cc:306
#5  0x0000000001cf333e in pfs_spawn_thread (arg=0x4a94790) at /home/wl/software/mysql5726/storage/perfschema/pfs.cc:2190
#6  0x00007f12671afdd5 in start_thread () from /lib64/libpthread.so.0
#7  0x00007f1265e7502d in clone () from /lib64/libc.so.6

(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->arg_count
$19 = 2

文件 item_func.h 


(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->args
$20 = (Item **) 0x7f1240006f80
(gdb) p *((Item_func *)(thd->lex->select_lex->m_where_cond))->args
$21 = (Item_field *) 0x7f1240006db8
(gdb) p **((Item_func *)(thd->lex->select_lex->m_where_cond))->args
$22 = (Item_field) {
  <Item_ident> = {
    <Item> = {
      <Parse_tree_node> = {
        _vptr.Parse_tree_node = 0x2b91f10 <vtable for Item_field+16>, 
        contextualized = true, 
        transitional = false
      }, 
      members of Item: 
      is_expensive_cache = -1 '\377', 
      rsize = 0, 
      str_value = {
        m_ptr = 0x0, 
        m_length = 0, 
        m_charset = 0x2c94fe0 <my_charset_bin>, 
        m_alloced_length = 0, 
        m_is_alloced = false
      }, 
      item_name = {
        <Name_string> = {
          <Simple_cstring> = {
            m_str = 0x7f1240006490 "id1", 
            m_length = 3
          }, <No data fields>}, 
        members of Item_name_string: 
        m_is_autogenerated = true
      }, 
      orig_name = {
        <Name_string> = {
          <Simple_cstring> = {
            m_str = 0x0, 
            m_length = 0
          }, <No data fields>}, 
        members of Item_name_string: 
        m_is_autogenerated = true
      }, 
      next = 0x7f12400064a0, 
      max_length = 0, 
      marker = 0, 
      decimals = 0 '\000', 
      maybe_null = 0 '\000', 
      null_value = 0 '\000', 
      unsigned_flag = 0 '\000', 
      with_sum_func = 0 '\000', 
      fixed = 0 '\000', 
      collation = {
---Type <return> to continue, or q <return> to quit---
        collation = 0x2c94fe0 <my_charset_bin>, 
        derivation = DERIVATION_IMPLICIT, 
        repertoire = 3
      }, 
      cmp_context = 4294967295, 
      runtime_item = false, 
      derived_used = false, 
      with_subselect = 0 '\000', 
      with_stored_program = 0 '\000', 
      tables_locked_cache = false, 
      is_parser_item = true
    }, 
    members of Item_ident: 
    orig_db_name = 0x0, 
    orig_table_name = 0x0, 
    orig_field_name = 0x7f1240006490 "id1", 
    m_alias_of_expr = false, 
    context = 0x7f1240005970, 
    db_name = 0x0, 
    table_name = 0x0, 
    field_name = 0x7f1240006490 "id1", 
    cached_field_index = 4294967295, 
    cached_table = 0x0, 
    depended_from = 0x0
  }, 
  members of Item_field: 
  table_ref = 0x0, 
  field = 0x0, 
  result_field = 0x0, 
  item_equal = 0x0, 
  no_const_subst = false, 
  have_privileges = 0, 
  any_privileges = false
}


(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->args[0]->item_name
$25 = {
  <Name_string> = {
    <Simple_cstring> = {
      m_str = 0x7f1240006490 "id1", 
      m_length = 3
    }, <No data fields>}, 
  members of Item_name_string: 
  m_is_autogenerated = true
}


(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->args[0]->item_name->m_str
$26 = 0x7f1240006490 "id1"

p ((Item_func *)(thd->lex->select_lex->m_where_cond))->args[1]->item_name->m_str

(gdb) p ((Item_func *)(thd->lex->select_lex->m_where_cond))->args[1]->item_name->m_str
$27 = 0x7f1240006558 "1"



# 2. 语句  select sql_no_cache * from t1 where id1=1 and id2=1;


(gdb) p thd->lex->select_lex->m_where_cond
$30 = (Item_cond_and *) 0x7f12400068f8

(gdb) p thd->lex->select_lex->m_where_cond->type()
$40 = Item::COND_ITEM

(gdb) p ((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->functype()
$39 = Item_func::COND_AND_FUNC

(gdb) p ((Item_cond *)(thd->lex->select_lex->m_where_cond))->functype()
$47 = Item_func::COND_AND_FUNC

(gdb) p ((Item_cond *)(thd->lex->select_lex->m_where_cond))->func_name()
$50 = 0x1e3ce05 "and"

(gdb) p ((Item_cond *)(thd->lex->select_lex->m_where_cond))->argument_list
$7 = {List<Item> *(Item_cond * const)} 0x13ea776 <Item_cond::argument_list()>


(gdb) p ((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->elements
$22 = 2

(gdb) p ((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head()
$25 = (Item_func_eq *) 0x7f0e60007258


(gdb) p (Item_func_eq *)(((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head())
$28 = (Item_func_eq *) 0x7f0e60007258


(gdb) p ((Item_func_eq *)(((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head()))->functype()
$33 = Item_func::EQ_FUNC
(gdb) p ((Item_func_eq *)(((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head()))->argument_count()
$34 = 2


(gdb) p ((Item_func_eq *)(((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head()))->args[0]->item_name
$39 = {
  <Name_string> = {
    <Simple_cstring> = {
      m_str = 0x7f0e600064a0 "id1", 
      m_length = 3
    }, <No data fields>}, 
  members of Item_name_string: 
  m_is_autogenerated = true
}
(gdb) p ((Item_func_eq *)(((Item_cond_and *)(thd->lex->select_lex->m_where_cond))->argument_list()->head()))->args[1]->item_name
$40 = {
  <Name_string> = {
    <Simple_cstring> = {
      m_str = 0x7f0e60006568 "1", 
      m_length = 1
    }, <No data fields>}, 
  members of Item_name_string: 
  m_is_autogenerated = true
}





